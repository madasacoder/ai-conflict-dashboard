<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Workflow Load</title>
  </head>
  <body>
    <h1>Workflow Builder Debug Test</h1>
    <p>Check the browser console for any errors.</p>

    <div id="status">
      <h2>Status:</h2>
      <ul id="statusList"></ul>
    </div>

    <div>
      <h2>Actions:</h2>
      <button onclick="testWorkflowBuilder()">Test Load Workflow Builder</button>
      <button onclick="window.location.href='workflow-builder.html'">Go to Workflow Builder</button>
    </div>

    <script>
      function log(message, isError = false) {
        const li = document.createElement('li');
        li.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        if (isError) li.style.color = 'red';
        document.getElementById('statusList').appendChild(li);
        console.log(message);
      }

      // Check if we can access the workflow builder page
      async function testWorkflowBuilder() {
        try {
          log('Testing workflow-builder.html access...');
          const response = await fetch('workflow-builder.html');
          log(`Response status: ${response.status}`);

          if (response.ok) {
            const text = await response.text();
            log(`Page loaded successfully (${text.length} bytes)`);

            // Check if JS file is referenced
            if (text.includes('workflow-builder-fixed-v2.js')) {
              log('✓ JS file reference found');

              // Try to load the JS file
              const jsResponse = await fetch('js/workflow-builder-fixed-v2.js');
              if (jsResponse.ok) {
                log(`✓ JS file accessible (${jsResponse.status})`);
              } else {
                log(`✗ JS file not accessible: ${jsResponse.status}`, true);
              }
            }

            // Check for Drawflow CDN
            if (text.includes('drawflow')) {
              log('✓ Drawflow references found');
            }
          } else {
            log(`✗ Failed to load page: ${response.status} ${response.statusText}`, true);
          }
        } catch (error) {
          log(`✗ Error: ${error.message}`, true);
        }
      }

      // Log current location
      log(`Current URL: ${window.location.href}`);

      // Add error handler
      window.addEventListener('error', (event) => {
        log(`✗ JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}`, true);
      });

      // Add unhandled rejection handler
      window.addEventListener('unhandledrejection', (event) => {
        log(`✗ Unhandled Promise Rejection: ${event.reason}`, true);
      });
    </script>
  </body>
</html>
